<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/defaultLayout}">
    <head>
        <title>Home</title>
        <th:block layout:fragment="css">
            <link rel="stylesheet" th:href="@{/css/home.css}">
            <link rel="stylesheet" th:href="@{/css/reservation.css}">
        </th:block>
        <style>
            /* ìš°ì¸¡ ìœ„ì ¯ ì»¬ëŸ¼ ìŠ¤íƒ€ì¼ (dday, ì¼ì •)*/
            .rightCol {
                display: flex;
                flex-direction: column;
                gap: 0; /* ìœ„ì ¯ ì‚¬ì´ì˜ ê¸°ë³¸ ê°„ê²©ì€ 0ìœ¼ë¡œ í•˜ê³  ê° ìœ„ì ¯ì˜ marginìœ¼ë¡œ ì¡°ì ˆ */
            }

            /* ============================================
            ëª¨ë˜ ìº˜ë¦°ë” ìœ„ì ¯ ìŠ¤íƒ€ì¼ (FullCalendar ì»¤ìŠ¤í„°ë§ˆì´ì§•)
            ============================================ */

            /* =========================
            1. ìœ„ì ¯ ì»¨í…Œì´ë„ˆ
            ========================= */
            .home-schedule-widget {
                background: #ffffff;
                border-radius: 16px;
                padding: 0;
                margin: 20px 0;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
                overflow: hidden;
                border: none;
            }

            /* =========================
            2. í—¤ë” ì˜ì—­
            ========================= */
            .widget-header {
                background: #ffffff;
                padding: 20px 24px;
                border-bottom: 1px solid #f1f3f5;
            }

            .widget-header h3 {
                font-size: 1.1rem;
                font-weight: 600;
                margin: 0;
                color: #212529;
            }

            /* =========================
            3. ìº˜ë¦°ë” ë³¸ì²´
            ========================= */
            #mini-calendar {
                background: #ffffff;
                padding: 20px;
                border: none;
                max-height: 400px;  /* ìµœëŒ€ ë†’ì´ ì„¤ì • */
                overflow-y: auto;   /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
                overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ìˆ¨ê¹€ */
            }

            /* =========================
            4. ëª¨ë“  í…Œë‘ë¦¬ ì œê±°
            ========================= */
            #mini-calendar .fc-scrollgrid,
            #mini-calendar .fc-scrollgrid-section,
            #mini-calendar .fc-scrollgrid-section > td,
            #mini-calendar .fc-scrollgrid-section-body > td,
            #mini-calendar .fc-scrollgrid-sync-table,
            #mini-calendar .fc-timegrid-body,
            #mini-calendar .fc-timegrid-slots,
            #mini-calendar .fc-timegrid-slots table,
            #mini-calendar .fc-timegrid-slots td,
            #mini-calendar .fc-timegrid-axis,
            #mini-calendar .fc-timegrid-axis-frame,
            #mini-calendar .fc-timegrid-axis-chunk,
            #mini-calendar .fc-timegrid-slot-label-frame,
            #mini-calendar .fc-timegrid-cols,
            #mini-calendar .fc-timegrid-cols table,
            #mini-calendar .fc-timegrid-col,
            #mini-calendar .fc-scroller,
            #mini-calendar .fc-scroller-liquid,
            #mini-calendar .fc-scroller-liquid-absolute,
            #mini-calendar .fc-col-header {
                border: none !important;
                outline: none !important;
            }

            /* =========================
            5. ì‹œê°„ êµ¬ë¶„ì„  ì„¤ì •
            ========================= */
            /* ê° ì‹œê°„ ìŠ¬ë¡¯ì´ í™•ì‹¤íˆ êµ¬ë¶„ë˜ë„ë¡ - ì´ê²ƒë§Œ ì‚¬ìš© */
            #mini-calendar .fc-timegrid-slots tr {
                border-bottom: 1px solid #dee2e6 !important;
            }

            /* ë‹¤ë¥¸ ëª¨ë“  border ì œê±° */
            #mini-calendar .fc-timegrid-slot {
                height: 40px !important;
                border: none !important;
            }

            #mini-calendar .fc-timegrid-slot-label-frame {
                border: none !important;  /* ì´ ë¶€ë¶„ ì œê±°! */
            }

            #mini-calendar .fc-timegrid-slot-lane {
                border: none !important;
            }

            /* ë§ˆì§€ë§‰ ì‹œê°„ ìŠ¬ë¡¯ì˜ ì„  ì œê±° */
            #mini-calendar .fc-timegrid-slots tr:last-child {
                border-bottom: none !important;
            }

            /* 30ë¶„ ë‹¨ìœ„ ìŠ¬ë¡¯ ìˆ¨ê¸°ê¸° */
            #mini-calendar .fc-timegrid-slot-minor {
                display: none;
            }

            /* ì„ ì´ ì „ì²´ ë„ˆë¹„ë¡œ ì—°ê²°ë˜ë„ë¡ ì„¤ì • */
            #mini-calendar .fc-timegrid-slots table {
                width: 100%;
            }

            /* =========================
            6. ì‹œê°„ ë¼ë²¨ ìŠ¤íƒ€ì¼
            ========================= */
            #mini-calendar .fc-timegrid-slot-label {
                font-size: 0.75rem;
                font-weight: 400;
                color: #6c757d;
                vertical-align: top;
                padding-top: 4px;
                border-top: none !important;
                border-left: none !important;
                border-right: none !important;
            }

            #mini-calendar .fc-timegrid-slot-label-cushion {
                padding: 8px 4px;
            }

            /* ì‹œê°„ì¶•ê³¼ ì´ë²¤íŠ¸ ì˜ì—­ ì‚¬ì´ ì„¸ë¡œì„  ì œê±° */
            #mini-calendar .fc-timegrid-axis,
            #mini-calendar .fc-timegrid-divider {
                border: none !important;
                display: none;
            }

            /* =========================
            7. ë°°ê²½ìƒ‰ ì„¤ì •
            ========================= */
            #mini-calendar .fc-day,
            #mini-calendar .fc-timegrid-col,
            #mini-calendar .fc-timegrid-col-bg,
            #mini-calendar .fc-day-today {
                background: #ffffff !important;
            }

            #mini-calendar .fc-timegrid-col-events { 
                /* ì´ë²¤íŠ¸ê°€ ê·¸ë ¤ì§€ëŠ” ì˜ì—­ì˜ ì™¼ìª½ ì—¬ë°±ì„ 50pxë¡œ ì„¤ì •í•˜ì—¬ ì‹œê°„ ë¼ë²¨ ê³µê°„ì„ í™•ë³´í•©ë‹ˆë‹¤. */
                margin-left: 50px !important; 
                /* ìš°ì¸¡ì—ë„ ì•½ê°„ì˜ ì—¬ë°±ì„ ì¤ë‹ˆë‹¤. */
                margin-right: 4px !important;
            }

            /* =========================
            8. ì´ë²¤íŠ¸ ìŠ¤íƒ€ì¼
            ========================= */
            #mini-calendar .fc-event {
                border: none !important;
                background: transparent !important;
                padding: 2px !important;
                margin: 1px !important;
            }

            #mini-calendar .fc-event:hover {
                transform: translateY(-1px);
                transition: transform 0.2s ease;
            }

            /* FullCalendar ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì œê±° */
            #mini-calendar .fc-event-main {
                background: transparent !important;
                border: none !important;
            }

            #mini-calendar .fc-timegrid-event {
                margin: 1px;
                z-index: auto !important;
            }

            /* =========================
            9. ì¶”ê°€ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼
            ========================= */
            /* í˜„ì¬ ì‹œê°„ í‘œì‹œì„  */
            #mini-calendar .fc-timegrid-now-indicator-line {
                border: 2px solid #ef4444;
                border-radius: 2px;
            }

            #mini-calendar .fc-timegrid-now-indicator-arrow {
                border-color: #ef4444;
            }

            /* ë¹ˆ ìŠ¬ë¡¯ hover íš¨ê³¼ */
            #mini-calendar .fc-timegrid-slot-lane:hover {
                background: rgba(102, 126, 234, 0.03);
                transition: background 0.2s ease;
            }

            /* ìŠ¤í¬ë¡¤ë°” */
            #mini-calendar::-webkit-scrollbar {
                width: 6px;
            }

            #mini-calendar::-webkit-scrollbar-thumb {
                background: #dee2e6;
                border-radius: 10px;
            }

            #mini-calendar::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 10px;
            }

            /* =========================
            10. ì• ë‹ˆë©”ì´ì…˜
            ========================= */
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateX(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            /* =========================
            11. ë°˜ì‘í˜• ë””ìì¸
            ========================= */
            @media (max-width: 768px) {
                .home-schedule-widget {
                    margin: 10px 0;
                    border-radius: 16px;
                }
                .widget-header {
                    padding: 16px 20px;
                }
                #mini-calendar {
                    padding: 16px;
                }
            }


            /* --- D-Day ìœ„ì ¯  --- */
            .dday-widget {
                margin: 0;
                background-color: transparent;
                box-shadow: none;
                padding: 0;
                cursor: pointer;
                display: flex;
                flex-direction: column;
                gap: 10px; /* ì¹´ë“œ ì‚¬ì´ì˜ ê°„ê²© */

                /* ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ */
                max-height: 150px; /* ìœ„ì ¯ì˜ ìµœëŒ€ ë†’ì´ (ì¹´ë“œ 2ê°œ ì •ë„) */
                overflow-y: auto;  /* ë‚´ìš©ì´ max-heightë¥¼ ë„˜ìœ¼ë©´ ìë™ìœ¼ë¡œ ì„¸ë¡œ ìŠ¤í¬ë¡¤ ìƒì„± */
            }

            /* ìƒˆë¡œìš´ D-Day ì¹´ë“œ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
            .dday-item {
                display: flex;
                align-items: center;
                padding: 15px 20px;
                border-radius: 16px;
                background-color: #e3eafc; /* ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½ */
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                transition: transform 0.2s;
            }
            .dday-item:hover {
                transform: translateY(-2px);
            }

            /* D-Day ì¹´ìš´í„° (D-54) ìŠ¤íƒ€ì¼ */
            .dday-counter {
                font-size: 1.2em;
                font-weight: 700;
                color: #495057;
                margin-right: 15px;
                min-width: 4em;      /* ìµœì†Œ ë„ˆë¹„ë¥¼ ê¸€ì í¬ê¸°ì˜ 4ë°°ë¡œ ì§€ì • (ê°’ ì¡°ì ˆ ê°€ëŠ¥) */
                display: inline-block; /* span íƒœê·¸ì— ë„ˆë¹„ ì†ì„±ì„ ì ìš©í•˜ê¸° ìœ„í•´ í•„ìš” */
            }

            /* D-Day ì œëª© ìŠ¤íƒ€ì¼ */
            .dday-title {
                font-size: 1em;
                font-weight: 500;
                color: #495057;
            }

            /* D-Day ì—†ì„ ë•Œ ì•ˆë‚´ ë¬¸êµ¬ ìŠ¤íƒ€ì¼ */
            .dday-item-empty {
                width: 100%;
                text-align: center;
                color: #868e96;
                font-size: 0.9em;
                padding: 20px;
                background-color: #f8f9fa;
                border-radius: 16px;
                box-sizing: border-box;
            }

            /* D-Day ì¹´ìš´í„° (D-54) ìŠ¤íƒ€ì¼ */
            .dday-counter {
                font-size: 1.2em;
                font-weight: 700;
                color: #495057;
                margin-right: 15px;
            }

            /* D-Day ì œëª© ìŠ¤íƒ€ì¼ */
            .dday-title {
                font-size: 1em;
                font-weight: 500;
                color: #495057;
            }
            /* --- D-Day ëª¨ë‹¬ --- */
            .dday-modal-overlay {
                position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 10000;
            }
            .dday-modal-content {
                background: white; border-radius: 20px; padding: 24px; width: 90%; max-width: 450px;
            }
            .dday-modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #e9ecef; padding-bottom: 16px; }
            .dday-modal-header h3 { margin: 0; font-size: 1.2em; }
            .close-button { background: none; border: none; font-size: 1.8em; cursor: pointer; overflow-x: hidden;}
            .dday-list { list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-x: hidden; overflow-y: auto; }
            .dday-list li { display: flex; align-items: center; padding: 12px 8px; border-bottom: 1px solid #f1f3f5; }
            .dday-list li:last-child { border-bottom: none; }
            .dday-list input[type="checkbox"] { margin-right: 15px; width: 20px; height: 20px; }
            .dday-list .dday-date { font-size: 0.8em; color: #868e96; } 
            .dday-empty-state {
                display: flex;
                flex-direction: column; /* ìì‹ ìš”ì†Œë“¤ì„ ì„¸ë¡œë¡œ ì •ë ¬ */
                min-height: 150px; /* ìµœì†Œ ë†’ì´ ì§€ì • */
            }
            .dday-empty-state .dday-modal-body { flex-grow: 1; display: flex; align-items: center; justify-content: center; padding: 20px; font-size: 1.1em; }
            .dday-empty-state .dday-modal-footer { text-align: right; padding: 20px; border-top: 1px solid #e9ecef; }
            .dday-modal-footer { margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef; text-align: right; }
            .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
            .btn-primary { background: #4258BE; color: white; }

            /* D-Day ì •ë³´ ì˜ì—­ (ì œëª© + ë‚ ì§œ) */
            .dday-list .dday-info {
                flex-grow: 1;       /* ê¸°ì¡´ ì†ì„± ìœ ì§€ */
                overflow: hidden;     /* (ì¶”ê°€) ìì‹ ìš”ì†Œ(ì œëª©)ê°€ ì˜ì—­ì„ ë„˜ì¹˜ë©´ ìˆ¨ê¹€ ì²˜ë¦¬ */
                margin-right: 10px; /* (ì¶”ê°€) ì œëª©ê³¼ ìš°ì¸¡ ì¹´ìš´í„° ì‚¬ì´ì˜ ê°„ê²©ì„ ì¤Œ */
                min-width: 0; /* <<<<<<< âœ¨ ì´ í•œ ì¤„ì´ í•µì‹¬ì…ë‹ˆë‹¤! */
            }

            /* D-Day ì œëª© ìŠ¤íƒ€ì¼ */
            .dday-list .dday-title {
                white-space: nowrap;      /* (ì¶”ê°€) ì œëª©ì´ ê¸¸ì–´ë„ ì¤„ë°”ê¿ˆí•˜ì§€ ì•ŠìŒ */
                overflow: hidden;         /* (ì¶”ê°€) ì˜ì—­ì„ ë„˜ì–´ê°€ëŠ” í…ìŠ¤íŠ¸ëŠ” ìˆ¨ê¹€ */
                text-overflow: ellipsis;  /* (ì¶”ê°€) ìˆ¨ê²¨ì§„ í…ìŠ¤íŠ¸ë¥¼ ... ìœ¼ë¡œ í‘œì‹œ */
            }


            /* //////////////////////////////////////////////////////////////// */
            /* ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ì˜ì—­ í¬ê¸° */
            .boardList {
                width: 100%;
                max-height: 300px;  /* ìµœëŒ€ ë†’ì´ */
                overflow: auto;     /* ê°€ë¡œ, ì„¸ë¡œ í¬ê¸° ì´ˆê³¼ ì‹œ ìŠ¤í¬ë¡¤ë¡œ */
            }

            /* ê° ì¹´í…Œê³ ë¦¬ ìŠ¤íƒ€ì¼ */
            .board-item {
                color: #4b5563; /* Muted text color */
                padding: 10px 14px;
                border-radius: 8px;
                transition: all 0.2s;
                cursor: pointer;
                font-size: 15px;
                font-weight: 500;
                text-decoration: none;
                display: block;
                border: 1px solid transparent;
            }

            .board-item:hover {
                background-color: #f3f4f6; /* Light gray hover */
                color: #111827;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="mainGrid" aria-label="ë©”ì¸ ì˜ì—­" layout:fragment="content">

            <!-- ì¢Œ: ìš´ì˜ì‹¤ + ìƒˆë¡œìš´ ì§ˆë¬¸ (2ë‹¨ ë¸”ë¡) -->
            <div class="leftCol">
                <!-- /** ìš´ì˜ì‹¤
                    @desc   íŒŒë€ìƒ‰ í—¤ë”(í´ë¦­ â†’ operations.html) + ë³¸ë¬¸(ê³µì§€ ë¦¬ìŠ¤íŠ¸)
                    @param  ì—†ìŒ
                    @return ì—†ìŒ(UI) */ -->
                <section class="stackCard" aria-label="ìš´ì˜ì‹¤">
                    <a class="sectionHead" th:href="@{/admin}">é‹å–¶å®¤</a>
                    <div class="sectionBody">
                    <ul class="noticeList">
                        <li th:if="${#lists.isEmpty(latestAnnouncements)}">
                            æ–°ã—ã„ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                        </li>
                        <li th:each="notice : ${latestAnnouncements}">
                            <a th:href="@{/admin/announcement/read(postId=${notice.postId})}">
                                <div class="notice-item">
                                    <div class="notice-header">
                                        <span><i class="fa-solid fa-bullhorn"></i> [[${notice.board}]]</span>
                                        <span class="date">[[${#temporals.format(notice.createdAt, 'MMæœˆ ddæ—¥ HH:mm')}]]</span>
                                    </div>
                                    <p class="title">[[${notice.title}]]</p>
                                </div>
                            </a>
                        </li>
                    </ul>
                    </div>
                </section>

                <section class="stackCard" aria-label="ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬">
                    <a class="sectionHead" th:href="@{/community/home}">æ²ç¤ºæ¿ã‚«ãƒ†ã‚´ãƒªãƒ¼</a>
                    <!-- ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
                    <nav class="sectionBody">
                        <div class="boardList">
                            <th:block th:each="board : ${boardMap}">
                                <a th:href="@{/community/board(name=${board.key})}"
                                class="board-item"
                                th:text="${board.value}">
                                </a>
                            </th:block>
                        </div>
                    </nav>
                </section>

                <!-- /** ìƒˆë¡œìš´ ì§ˆë¬¸
                    @desc   íŒŒë€ìƒ‰ í—¤ë”(í´ë¦­ â†’ question_submit.html) + ë³¸ë¬¸(ì…ë ¥ì°½)
                    @param  ì—†ìŒ
                    @return ì—†ìŒ(UI) */ -->
                <!-- <section class="stackCard" aria-label="ìƒˆë¡œìš´ ì§ˆë¬¸">
                    <a class="sectionHead" href="question_submit.html">æ–°ã—ã„è³ªå•</a>
                    <div class="sectionBody">
                        <div class="askBox" role="search">
                            <input type="text" id="newQuestionInput" placeholder="å›ç­”ã™ã‚‹" aria-label="ë‹µë³€ ì…ë ¥" />
                            <button class="btn-search" type="button" onclick="location.href='question_submit.html'">ç™»éŒ²</button>
                        </div>
                    </div>
                </section> -->
            </div>

            <!-- ì¤‘: ê²€ìƒ‰ â†’ ì¢Œì„ë°°ì¹˜ë„(ë¹„ìœ¨ ìœ ì§€) -->
            <div class="centerCol">

                <!-- ê²€ìƒ‰(ì¤‘ì•™ ì»¬ëŸ¼ ë„ˆë¹„ = ì¢Œì„ë°°ì¹˜ë„ ë„ˆë¹„) -->
                <div class="search-row" role="search">
                    <div class="search-input">
                        <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
                        <input type="text" placeholder="æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" aria-label="ê²€ìƒ‰ì–´" />
                    </div>
                    <button class="btn-search" aria-label="ê²€ìƒ‰ ë²„íŠ¼">æ¤œç´¢</button>
                </div>

                <!-- ì¢Œì„ë°°ì¹˜ë„ -->
                <section class="seatmapCard card" aria-label="ì¢Œì„ë°°ì¹˜ë„ ì¹´ë“œ">
                    <div class="seatmap" aria-label="ê°•ì˜ì‹¤ ì¢Œì„ë°°ì¹˜ë„" style="--cols:16; --rows:10;">
                        <!-- ìƒë‹¨ ìŠ¬ë¦¼ ë¼ë²¨ ë°” -->
                        <div class="block labelBar" style="grid-column:3 / span 9; grid-row:1 / span 1;">å¤§è¬›ç¾©å®¤</div>
                        <div class="block labelBar" style="grid-column:14 / span 3; grid-row:1 / span 1;">ãƒ©ã‚¦ãƒ³ã‚¸</div>

                        <!-- ì„¸ë¡œ ë³µë„ 3ê°œ -->
                        <div class="corridor" style="grid-column:5  / span 1; grid-row:3 / span 8;"></div>
                        <div class="corridor" style="grid-column:9  / span 1; grid-row:3 / span 8;"></div>
                        <div class="corridor" style="grid-column:13 / span 1; grid-row:3 / span 8;"></div>

                        <!-- ì¢Œì¸¡ ì„¸ë¡œì—´ -->
                        <a class="block small room" href="#" data-room-id="5" th:data-room-name="${classroomMap.get(5).getClassroomName()}" th:classappend="${classroomMap.get(5).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:3 / span 1; text-decoration:none;" >ãƒ«ãƒ¼ãƒ 5</a>
                        <a class="block small room" href="#" data-room-id="4" th:data-room-name="${classroomMap.get(4).getClassroomName()}" th:classappend="${classroomMap.get(4).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:4 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 4</a>
                        <a class="block small room" href="#" data-room-id="3" th:data-room-name="${classroomMap.get(3).getClassroomName()}" th:classappend="${classroomMap.get(3).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:5 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 3</a>
                        <a class="block small room" href="#" data-room-id="2" th:data-room-name="${classroomMap.get(2).getClassroomName()}" th:classappend="${classroomMap.get(2).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:6 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 2</a>
                        <a class="block small room" href="#" data-room-id="1" th:data-room-name="${classroomMap.get(1).getClassroomName()}" th:classappend="${classroomMap.get(1).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:7 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 1</a>
                        <div class="block small gray"  style="grid-column:1 / span 2; grid-row:8 / span 1;">å€‰åº«</div>
                        <div class="block small label" style="grid-column:1 / span 2; grid-row:9 / span 1;">é¢æ¥å®¤2</div>
                        <div class="block small label" style="grid-column:1 / span 2; grid-row:10 / span 1;">é¢æ¥å®¤1</div>

                        <!-- ì¢Œì¸¡ 2ì—´ -->
                        <a class="block small room" href="#" data-room-id="10" th:data-room-name="${classroomMap.get(10).getClassroomName()}" th:classappend="${classroomMap.get(10).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:3 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 10</a>
                        <a class="block small room" href="#" data-room-id="9" th:data-room-name="${classroomMap.get(9).getClassroomName()}" th:classappend="${classroomMap.get(9).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:4 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 9</a>
                        <a class="block small room" href="#" data-room-id="8" th:data-room-name="${classroomMap.get(8).getClassroomName()}" th:classappend="${classroomMap.get(8).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:5 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 8</a>
                        <a class="block small room" href="#" data-room-id="7" th:data-room-name="${classroomMap.get(7).getClassroomName()}" th:classappend="${classroomMap.get(7).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:6 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 7</a>
                        <a class="block small room" href="#" data-room-id="6" th:data-room-name="${classroomMap.get(6).getClassroomName()}" th:classappend="${classroomMap.get(6).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:7 / span 1; text-decoration:none;">ãƒ«ãƒ¼ãƒ 6</a>
                        <div class="block gray" style="grid-column:3 / span 2; grid-row:8 / span 3; font-size:12px;">äº‹å‹™å®¤</div>

                        <!-- ê°€ìš´ë° ì™¼ ì—´ -->
                        <div class="block"       style="grid-column:6 / span 3; grid-row:3 / span 2;">è¬›ç¾©å®¤4</div>
                        <div id="lectureRoom3" class="block room reservable clickable-block" style="grid-column:6 / span 3; grid-row:5 / span 2; background:#cfe0ff;">è¬›ç¾©å®¤3</div>
                        <div class="block"       style="grid-column:6 / span 3; grid-row:7 / span 2;">è¬›ç¾©å®¤2</div>
                        <div class="block"       style="grid-column:6 / span 3; grid-row:9 / span 2;">è¬›ç¾©å®¤1</div>

                        <!-- ê°€ìš´ë° ì˜¤ë¥¸ ì—´ -->
                        <div class="block" style="grid-column:10 / span 3; grid-row:3 / span 2;">è¬›ç¾©å®¤8</div>
                        <div class="block" style="grid-column:10 / span 3; grid-row:5 / span 2;">è¬›ç¾©å®¤7</div>
                        <div class="block" style="grid-column:10 / span 3; grid-row:7 / span 2;">è¬›ç¾©å®¤6</div>
                        <div class="block" style="grid-column:10 / span 3; grid-row:9 / span 2;">è¬›ç¾©å®¤5</div>

                        <!-- ìš°ì¸¡ ì—´ (ë¼ìš´ë“œ ê°•ì¡°) -->
                        <div class="block reservable clickable-block" style="grid-column:14 / span 3; grid-row:3 / span 2; border-radius:22px; background:#cfe0ff;">è¬›ç¾©å®¤12</div>
                        <div class="block reservable clickable-block" style="grid-column:14 / span 3; grid-row:5 / span 2; border-radius:22px; background:#cfe0ff;">è¬›ç¾©å®¤11</div>
                        <div class="block"       style="grid-column:14 / span 3; grid-row:7 / span 2; border-radius:22px;">è¬›ç¾©å®¤10</div>
                        <div class="block"       style="grid-column:14 / span 3; grid-row:9 / span 2; border-radius:22px;">è¬›ç¾©å®¤9</div>
                    </div>
                </section>
            </div>

            <!-- ìš°: ì¼ì • -->
            <!-- <div class="rightCol">
                <section class="card" aria-label="ì¼ì •">
                    <h3 class="sectionTitle">æ—¥ç¨‹</h3>
                    <ul class="scheduleList">
                    <li>ì˜ˆì‹œ) 09/03(ìˆ˜) íŒ€ í”„ë¡œì íŠ¸ í‚¥ì˜¤í”„</li>
                    <li>ì˜ˆì‹œ) 09/05(ê¸ˆ) ê³¼ì œ ì œì¶œ ë§ˆê°</li>
                    </ul>
                </section>
            </div> -->
            <div class="rightCol">
                <!-- ë””ë°ì´ ìœ„ì ¯ -->
                <div id="ddayWidget" class="dday-widget" style="display: none;">
                    </div>
                <!-- ì¼ì • ìœ„ì ¯ -->
                <div class="home-schedule-widget">
                    <div class="widget-header">
                        <h3 id="widget-date-title"></h3>
                    </div>
                    <div id="mini-calendar"></div>
                </div>
            </div>
            <!-- 3ê°•ì˜ì‹¤ ì¢Œì„ë°°ì¹˜ë„ -->
            <div id="seatModal" class="modal-overlay">
                <div class="modal-content">
                    <button class="close-button" aria-label="ë‹«ê¸°">&times;</button>
                    <img th:src="@{/images/seat/roomseat(3).png}" alt="3ê°•ì˜ì‹¤ ì¢Œì„ë°°ì¹˜ë„ ì´ë¯¸ì§€">
                </div>
            </div>

            <!-- ì˜ˆì•½ ëª¨ë‹¬ -->
            <div class="reservationModal" id="reservationModal">
                <div class="reservation-modal">
                    <div class="modal-tabs">
                        <h2 class="tab-btn active" id="reservationModalTitle">ã‚¹ã‚¿ãƒ‡ã‚£ãƒ«ãƒ¼ãƒ </h2>
                        <div id="adminControlsContainer" class="admin-controls" style="display: none;"></div>
                    </div>

                    <div class="modal-body">
                    </div>
                </div>
            </div>
            <!-- dday ëª¨ë‹¬ -->
            <div id="ddaySelectModal" class="dday-modal-overlay" style="display: none;">
                <div class="dday-modal-content">
                    <div class="dday-modal-header">
                        <h3>ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¡¨ç¤ºã™ã‚‹D-Dayã‚’é¸æŠ</h3>
                        <button id="closeDdayModal" class="close-button">&times;</button>
                    </div>
                    <div id="ddayModalBody" class="dday-modal-body">
                        <ul id="ddayList" class="dday-list"></ul>
                        <div id="ddayEmptyState" class="dday-empty-state" style="display: none;"> 
                            <div class="dday-modal-body">ç™»éŒ²ã•ã‚ŒãŸD-DayãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
                            <div class="dday-modal-footer">
                                <a th:href="@{/calendar/dDay}" class="btn btn-primary">D-Dayã‚’ä½œæˆã™ã‚‹</a>
                            </div>
                        </div>
                    </div>
                    <div id="ddayModalFooter" class="dday-modal-footer">
                        <button id="savePinnedDdays" class="btn btn-primary">é¸æŠå†…å®¹ã‚’ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>
        </section>
        <th:block layout:fragment="script">
            <!-- FullCalendar CDN -->
            <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
            <script th:src="@{/js/reservation.js}"></script>

            <script>
                        // ================== ğŸ‘‡ ì´ í•œ ì¤„ì„ ì¶”ê°€! ==================
                        console.log("--- home.html ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ ì‹œì‘! ---");
                        // =======================================================
                document.addEventListener('DOMContentLoaded', function() {
                    initializeDdayWidget();
                    initializeCalendarWidget();
                });

                // ==========================================================
                // D-Day ìœ„ì ¯ ê´€ë ¨ í•¨ìˆ˜ë“¤
                // ==========================================================
                async function initializeDdayWidget() {
                    const widget = document.getElementById('ddayWidget');
                    const modal = document.getElementById('ddaySelectModal');
                    const closeModalBtn = document.getElementById('closeDdayModal');
                    const saveBtn = document.getElementById('savePinnedDdays');

                    const allDdays = await fetchAllDdays();
                    if (allDdays) {
                        renderDdayWidget(allDdays);
                        renderDdayModal(allDdays);
                    }

                    widget.addEventListener('click', () => modal.style.display = 'flex');
                    closeModalBtn.addEventListener('click', () => modal.style.display = 'none');
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) modal.style.display = 'none';
                    });
                    saveBtn.addEventListener('click', () => savePinnedDdays(allDdays));
                }

                async function fetchAllDdays() {
                    try {
                        const response = await fetch('/scitHub/api/ddays');

                        if (!response.ok) throw new Error('D-Day data fetch failed');
                        return await response.json();
                    } catch (error) {
                        console.error(error);
                        return []; // ì‹¤íŒ¨ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜
                    }
                }

                function renderDdayWidget(ddayEvents) {
                    const widget = document.getElementById('ddayWidget');
                    const allDdays = ddayEvents || [];
                    const pinnedDdays = allDdays.filter(d => d.pinned);   // .slice(0, 2) ì´ê±¸ë¡œ í‘œì‹œë˜ëŠ” D-Day ê°¯ìˆ˜ ì¡°ì ˆ

                    widget.style.display = 'flex';

                    if (pinnedDdays.length > 0) {
                        widget.innerHTML = pinnedDdays.map(dday => {
                            const { ddayString } = calculateDday(dday.dday);

                            // ì¹´ìš´í„°ì™€ ì œëª©ì„ ê°ê°ì˜ span íƒœê·¸ë¡œ ê°ì‹¸ì¤ë‹ˆë‹¤.
                            return `<div class="dday-item">
                                        <span class="dday-counter">${ddayString}</span>
                                        <span class="dday-title">${dday.title}</span>
                                    </div>`;
                        }).join('');
                    } else if (allDdays.length > 0) {
                        widget.innerHTML = `<div class="dday-item-empty">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ›ãƒ¼ãƒ ã«è¡¨ç¤ºã™ã‚‹D-Dayã‚’é¸æŠã—ã¾ã™ã€‚</div>`;
                    } else {
                        widget.innerHTML = `<div class="dday-item-empty">D-Dayã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</div>`;
                    }
                }

                function renderDdayModal(ddayEvents) {
                    const listEl = document.getElementById('ddayList');
                    const emptyEl = document.getElementById('ddayEmptyState');
                    const footerEl = document.getElementById('ddayModalFooter');

                    if (!ddayEvents || ddayEvents.length === 0) {
                        listEl.style.display = 'none';
                        footerEl.style.display = 'none';
                        emptyEl.style.display = 'block';
                        return;
                    }

                    listEl.style.display = 'block';
                    footerEl.style.display = 'block';
                    emptyEl.style.display = 'none';

                    listEl.innerHTML = ddayEvents.map(dday => {
                        const { ddayString, targetDate } = calculateDday(dday.dday);
                        const formattedDate = targetDate.toLocaleDateString('ja-JP');
                        return `<li>
                                    <input type="checkbox" data-id="${dday.ddayId}" ${dday.pinned ? 'checked' : ''}>
                                    <div class="dday-info"><div class="dday-title">${dday.title}</div><div class="dday-date">${formattedDate}</div></div>
                                    <div class="dday-counter">${ddayString}</div>
                                </li>`;
                    }).join('');

                    // ê°œìˆ˜ ë‘ê°œ ì œí•œ í•˜ëŠ” ì—­í• 
                    // listEl.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    //     checkbox.addEventListener('change', () => {
                    //         if (listEl.querySelectorAll('input[type="checkbox"]:checked').length > 2) {
                    //             alert('D-Dayã¯æœ€å¤§2ã¤ã¾ã§é¸æŠã§ãã¾ã™ã€‚');
                    //             checkbox.checked = false;
                    //         }
                    //     });
                    // });
                }

                // ì„ íƒí•œ D-Dayë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
                async function savePinnedDdays(allDdays) {
                    const checkedIds = Array.from(document.querySelectorAll('#ddayList input:checked')).map(box => box.dataset.id);
                    try {
                        const response = await fetch('/scitHub/api/dday/pin', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(checkedIds)
                        });
                        if (!response.ok) throw new Error('Failed to save');
                        alert('ä¿å­˜ã—ã¾ã—ãŸã€‚');
                        document.getElementById('ddaySelectModal').style.display = 'none';

                        const updatedDdays = allDdays.map(d => ({ ...d, pinned: checkedIds.includes(String(d.ddayId)) }));
                        renderDdayWidget(updatedDdays);
                        renderDdayModal(updatedDdays);
                    } catch (error) {
                        console.error(error);
                        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                    }
                }

                // ì´ í•¨ìˆ˜ í•˜ë‚˜ë§Œ êµì²´í•˜ë©´ ë‘ ê³³ì˜ ë¬¸ì œê°€ ëª¨ë‘ í•´ê²°ë©ë‹ˆë‹¤.
                function calculateDday(targetDateStr) {
                    // 1. nullì´ë‚˜ undefined ê°’ì´ ë“¤ì–´ì™€ë„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
                    if (!targetDateStr || typeof targetDateStr !== 'string') { 
                        return { ddayString: 'D-?', targetDate: new Date() };
                    }

                    // 2. ì‹œê°„ëŒ€ ë¬¸ì œ ì—†ì´ ë‚ ì§œ ê³„ì‚°
                    const parts = targetDateStr.split('-');
                    if (parts.length !== 3) {
                        return { ddayString: 'ë‚ ì§œ ì˜¤ë¥˜', targetDate: new Date() };
                    }
                    const [year, month, day] = parts.map(Number);
                    const targetDate = new Date(year, month - 1, day);

                    // 3. ì˜¤ëŠ˜ ë‚ ì§œì™€ ë¹„êµ
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    const diffTime = targetDate.getTime() - today.getTime();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    let ddayString;
                    if (diffDays === 0) {
                        ddayString = 'D-Day';
                    } else if (diffDays > 0) {
                        ddayString = `D-${diffDays}`;
                    } else {
                        ddayString = `D+${Math.abs(diffDays)}`;
                    }

                    return { ddayString, targetDate };
                }

                // ==========================================================
                // ìº˜ë¦°ë” ìœ„ì ¯ ê´€ë ¨ í•¨ìˆ˜
                // ==========================================================
                function initializeCalendarWidget() {
                    const calendarEl = document.getElementById('mini-calendar');
                    const titleEl = document.getElementById('widget-date-title');
                    if (!calendarEl || !titleEl) return;

                    const calendar = new FullCalendar.Calendar(calendarEl, {
                        locale: 'ja',
                        initialView: 'timeGridDay',
                        initialDate: new Date(),
                        slotEventOverlap: false,  // ì´ë²¤íŠ¸ê°€ ê²¹ì¹˜ì§€ ì•Šê²Œ
                        eventDisplay: 'block',    // ë¸”ë¡ í˜•íƒœë¡œ í‘œì‹œ
                        dayMaxEvents: false,      // ì´ë²¤íŠ¸ ê°œìˆ˜ ì œí•œ ì—†ìŒ
                        headerToolbar: false,
                        slotDuration: '01:00:00', // 30ë¶„ì—ì„œ 1ì‹œê°„ ë‹¨ìœ„ë¡œ ë³€ê²½
                        slotLabelInterval: '01:00:00', // 1ì‹œê°„ë§ˆë‹¤ ë¼ë²¨ í‘œì‹œ
                        allDaySlot: false,
                        dayHeaders: false,
                        height: 'auto',
                        contentHeight: 'auto',
                        slotMinTime: '08:00:00',
                        slotMaxTime: '23:00:00',
                        slotLabelFormat: { hour: '2-digit', minute: '2-digit', hour12: false },
                        allDayText: 'çµ‚æ—¥', // 'all-day' í…ìŠ¤íŠ¸ë¥¼ 'çµ‚æ—¥'ë¡œ ë³€ê²½
                        events: function(fetchInfo, successCallback, failureCallback) {
                            fetch('/scitHub/api/calendar/events?showPublic=true&showPrivate=true')
                                .then(res => res.ok ? res.json() : Promise.reject('Server error'))
                                .then(data => {
                                    const formattedEvents = data.map(event => ({
                                        ...event,
                                        color: event.visibility === 'PUBLIC' ? '#ff9f89' : '#3788d8',
                                    }));
                                    successCallback(formattedEvents);
                                })
                                .catch(err => {
                                    console.error('Failed to load calendar events:', err);
                                    failureCallback(err);
                                });
                        },
                        eventContent: function(arg) {
                            const title = arg.event.title;
                            const start = arg.event.start;
                            const end = arg.event.end;
                                                    
                            // ì´ë²¤íŠ¸ ê¸°ê°„(ë¶„) ê³„ì‚°
                            const durationMinutes = end ? (end.getTime() - start.getTime()) / 60000 : 60;
                            const isShortEvent = durationMinutes <= 60;

                            // 1. ì‹œì‘ ì‹œê°„ì€ í•­ìƒ ìˆìœ¼ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜í•©ë‹ˆë‹¤.
                            const startTime = start.toLocaleTimeString('ja-JP', {
                                hour: '2-digit',
                                minute: '2-digit',
                                hour12: false
                            });

                            // 2. ì¢…ë£Œ ì‹œê°„ì´ ìˆì„ ë•Œë§Œ ë³€í™˜í•˜ê³ , ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
                            const endTime = end ? end.toLocaleTimeString('ja-JP', {
                                hour: '2-digit',
                                minute: '2-digit',
                                hour12: false
                            }) : '';

                            // ìƒ‰ìƒ ê²°ì • (PUBLICì€ ì£¼í™©, PRIVATEëŠ” íŒŒë‘)
                            const isPublic = arg.event.extendedProps.visibility === 'PUBLIC';
                            const bgColor = isPublic ? '#ff8c42' : '#7c93c3';

                            // ì§§ì€ ì´ë²¤íŠ¸ì¼ ê²½ìš° ì‹œê°„ í…ìŠ¤íŠ¸ë¥¼ ìˆ¨ê¹€
                            const timeHtml = isShortEvent ? '' : `<div style="font-size: 0.7rem; opacity: 0.9;">${startTime} - ${endTime}</div>`;
                            
                            // HTML ìƒì„±
                            return {
                                html: `
                                    <div style="
                                        background: ${bgColor};
                                        color: white; 
                                        padding: 8px 12px; 
                                        border-radius: 8px;
                                        height: 100%;
                                        display: flex;
                                        flex-direction: column;
                                        justify-content: center;
                                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                    ">
                                        <div style="
                                            font-weight: 600;
                                            font-size: 0.85rem;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                            white-space: nowrap;
                                        ">${title}</div>
                                        ${timeHtml}
                                    </div>
                                `
                            };
                        },
                        viewDidMount: function(info) {
                            const currentDate = calendar.getDate();
                            titleEl.textContent = currentDate.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
                        }
                    });
                    calendar.render();
                }
            </script>
        </th:block>
    </body>
</html>