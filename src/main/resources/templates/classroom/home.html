<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/defaultLayout}">
    <head>
        <title>Home</title>
        <th:block layout:fragment="css">
            <link rel="stylesheet" th:href="@{/css/home.css}">
            <link rel="stylesheet" th:href="@{/css/reservation.css}">
            <link rel="stylesheet" th:href="@{/css/scheduleModal.css}">
            <link rel="stylesheet" th:href="@{/css/homeWidget.css}">
        </th:block>
    </head>
    <body>
        <div class="mainGrid" aria-label="메인 영역" layout:fragment="content">

            <!-- 좌: 운영실 + 새로운 질문 (2단 블록) -->
            <div class="leftCol">
                <!-- /** 운영실
                    @desc   파란색 헤더(클릭 → operations.html) + 본문(공지 리스트)
                    @param  없음
                    @return 없음(UI) */ -->
                <section class="stackCard" aria-label="운영실">
                    <a class="sectionHead" th:href="@{/admin}">運営室</a>
                    <div class="sectionBody">
                        <ul class="noticeList">
                            <li th:if="${#lists.isEmpty(latestAnnouncements)}">
                                新しいお知らせはありません。
                            </li>
                            <li th:each="notice : ${latestAnnouncements}">
                                <a th:href="@{/admin/announcement/read(postId=${notice.postId})}">
                                    <div class="notice-item">
                                        <div class="notice-header">
                                            <span th:switch="${notice.board}">
                                                <i class="fa-solid fa-bullhorn"></i>
                                                <span th:case="'announcement'">お知らせ</span>
                                                <span th:case="'announcementIT'">お知らせ - IT</span>
                                                <span th:case="'announcementJP'">お知らせ - 日本語</span>
                                                <span th:case="*">[[${notice.board}]]</span>
                                            </span>
                                            <span class="date">[[${#temporals.format(notice.createdAt, 'MM月 dd日 HH:mm')}]]</span>
                                        </div>
                                        <p class="title">[[${notice.title}]]</p>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>

                <section class="stackCard" aria-label="게시판 카테고리">
                    <a class="sectionHead" th:href="@{/community/home}">掲示板カテゴリー</a>
                    <!-- 게시판 카테고리 목록 -->
                    <nav class="sectionBody">
                        <div class="boardList">
                            <th:block th:each="board : ${boardMap}">
                                <a th:href="@{/community/board(name=${board.key})}"
                                class="board-item"
                                th:text="${board.value}">
                                </a>
                            </th:block>
                        </div>
                    </nav>
                </section>
            </div>

            <!-- 중: 검색 → 좌석배치도(비율 유지) -->
            <div class="centerCol">
                <!-- 좌석배치도 -->
                <section class="seatmapCard card" aria-label="좌석배치도 카드">
                    <div class="seatmap" aria-label="강의실 좌석배치도" style="--cols:16; --rows:10;">
                        <!-- 상단 슬림 라벨 바 -->
                        <div class="block labelBar" style="grid-column:3 / span 9; grid-row:1 / span 1;">大講義室</div>
                        <div class="block labelBar" style="grid-column:14 / span 3; grid-row:1 / span 1;">ラウンジ</div>

                        <!-- 세로 복도 3개 -->
                        <div class="corridor" style="grid-column:5  / span 1; grid-row:3 / span 8;"></div>
                        <div class="corridor" style="grid-column:9  / span 1; grid-row:3 / span 8;"></div>
                        <div class="corridor" style="grid-column:13 / span 1; grid-row:3 / span 8;"></div>

                        <!-- 좌측 세로열 -->
                        <a class="block small room" href="#" data-room-id="5" th:data-room-name="${classroomMap.get(5).getClassroomName()}" th:classappend="${classroomMap.get(5).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:3 / span 1; text-decoration:none;" >ルーム5</a>
                        <a class="block small room" href="#" data-room-id="4" th:data-room-name="${classroomMap.get(4).getClassroomName()}" th:classappend="${classroomMap.get(4).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:4 / span 1; text-decoration:none;">ルーム4</a>
                        <a class="block small room" href="#" data-room-id="3" th:data-room-name="${classroomMap.get(3).getClassroomName()}" th:classappend="${classroomMap.get(3).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:5 / span 1; text-decoration:none;">ルーム3</a>
                        <a class="block small room" href="#" data-room-id="2" th:data-room-name="${classroomMap.get(2).getClassroomName()}" th:classappend="${classroomMap.get(2).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:6 / span 1; text-decoration:none;">ルーム2</a>
                        <a class="block small room" href="#" data-room-id="1" th:data-room-name="${classroomMap.get(1).getClassroomName()}" th:classappend="${classroomMap.get(1).isActive} ? 'active-room'" style="grid-column:1 / span 2; grid-row:7 / span 1; text-decoration:none;">ルーム1</a>
                        <div class="block small gray"  style="grid-column:1 / span 2; grid-row:8 / span 1;">倉庫</div>
                        <div class="block small label" style="grid-column:1 / span 2; grid-row:9 / span 1;">面接室2</div>
                        <div class="block small label" style="grid-column:1 / span 2; grid-row:10 / span 1;">面接室1</div>

                        <!-- 좌측 2열 -->
                        <a class="block small room" href="#" data-room-id="10" th:data-room-name="${classroomMap.get(10).getClassroomName()}" th:classappend="${classroomMap.get(10).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:3 / span 1; text-decoration:none;">ルーム10</a>
                        <a class="block small room" href="#" data-room-id="9" th:data-room-name="${classroomMap.get(9).getClassroomName()}" th:classappend="${classroomMap.get(9).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:4 / span 1; text-decoration:none;">ルーム9</a>
                        <a class="block small room" href="#" data-room-id="8" th:data-room-name="${classroomMap.get(8).getClassroomName()}" th:classappend="${classroomMap.get(8).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:5 / span 1; text-decoration:none;">ルーム8</a>
                        <a class="block small room" href="#" data-room-id="7" th:data-room-name="${classroomMap.get(7).getClassroomName()}" th:classappend="${classroomMap.get(7).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:6 / span 1; text-decoration:none;">ルーム7</a>
                        <a class="block small room" href="#" data-room-id="6" th:data-room-name="${classroomMap.get(6).getClassroomName()}" th:classappend="${classroomMap.get(6).isActive} ? 'active-room'" style="grid-column:3 / span 2; grid-row:7 / span 1; text-decoration:none;">ルーム6</a>
                        <div class="block gray" style="grid-column:3 / span 2; grid-row:8 / span 3; font-size:12px;">事務室</div>

                        <!-- 가운데 왼 열 -->
                        <div class="block"       style="grid-column:6 / span 3; grid-row:3 / span 2;">講義室4</div>
                        <div id="lectureRoom3" class="block room reservable clickable-block" style="grid-column:6 / span 3; grid-row:5 / span 2; background:#cfe0ff;">講義室3</div>
                        <div class="block"       style="grid-column:6 / span 3; grid-row:7 / span 2;">講義室2</div>
                        <div class="block"       style="grid-column:6 / span 3; grid-row:9 / span 2;">講義室1</div>

                        <!-- 가운데 오른 열 -->
                        <div class="block" style="grid-column:10 / span 3; grid-row:3 / span 2;">講義室8</div>
                        <div class="block" style="grid-column:10 / span 3; grid-row:5 / span 2;">講義室7</div>
                        <div class="block" style="grid-column:10 / span 3; grid-row:7 / span 2;">講義室6</div>
                        <div class="block" style="grid-column:10 / span 3; grid-row:9 / span 2;">講義室5</div>

                        <!-- 우측 열 (라운드 강조) -->
                        <div class="block reservable clickable-block" style="grid-column:14 / span 3; grid-row:3 / span 2; border-radius:22px; background:#cfe0ff;">講義室12</div>
                        <div class="block reservable clickable-block" style="grid-column:14 / span 3; grid-row:5 / span 2; border-radius:22px; background:#cfe0ff;">講義室11</div>
                        <div class="block"       style="grid-column:14 / span 3; grid-row:7 / span 2; border-radius:22px;">講義室10</div>
                        <div class="block"       style="grid-column:14 / span 3; grid-row:9 / span 2; border-radius:22px;">講義室9</div>
                    </div>
                </section>
                <div class="sectionBody">
                    <!-- 인스타그램 피드 -->
                    <div class="instagram-feed">
                        <p th:if="${#lists.isEmpty(instagramPosts)}">
                            インスタグラム投稿を読み込むことができません。
                        </p>
                        <a th:each="post : ${instagramPosts}" th:href="${post.permalink}" target="_blank" class="insta-post">
                            <img th:src="${post.mediaUrl}" th:alt="${post.caption}" />
                            <div class="instagram-icon-overlay">
                                <i class="fa-brands fa-instagram"></i>
                            </div>
                            <div class="caption-overlay">
                                <p th:text="${post.caption}"></p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- 우: 디데이 + 일정 (2단 블록) -->
            <div class="rightCol">
                <!-- 디데이 위젯 -->
                <div id="ddayWidget" class="dday-widget" style="display: none;">
                    </div>
                <!-- 일정 위젯 -->
                <div class="home-schedule-widget">
                    <div class="widget-header">
                        <h3 id="widget-date-title" style="cursor: pointer; transition: color 0.2s;"></h3>
                    </div>
                    <div id="mini-calendar"></div>
                </div>
            </div>
            <!-- 3강의실 좌석배치도 -->
            <div id="seatModal" class="modal-overlay">
                <div class="modal-content">
                    <button class="close-button" aria-label="닫기">&times;</button>
                    <img th:src="@{/images/seat/roomseat(3).png}" alt="3강의실 좌석배치도 이미지">
                </div>
            </div>

            <!-- 예약 모달 -->
            <div class="reservationModal" id="reservationModal">
                <div class="reservation-modal">
                    <div class="modal-tabs">
                        <h2 class="tab-btn active" id="reservationModalTitle">スタディルーム</h2>
                        <div id="adminControlsContainer" class="admin-controls" style="display: none;"></div>
                    </div>

                    <div class="modal-body">
                    </div>
                </div>
            </div>

            <!-- dday 모달 -->
            <div id="ddaySelectModal" class="dday-modal-overlay" style="display: none;">
                <div class="dday-modal-content">
                    <div class="dday-modal-header">
                        <h3>ホーム画面に表示するD-Dayを選択</h3>
                        <button id="closeDdayModal" class="close-button">&times;</button>
                    </div>
                    <div id="ddayModalBody" class="dday-modal-body">
                        <ul id="ddayList" class="dday-list"></ul>
                        <div id="ddayEmptyState" class="dday-empty-state" style="display: none;">
                            <div class="dday-modal-body">登録されたD-Dayがありません。</div>
                            <div class="dday-modal-footer">
                                <a th:href="@{/calendar/dDay}" class="btn btn-primary">D-Dayを作成する</a>
                            </div>
                        </div>
                    </div>
                    <div id="ddayModalFooter" class="dday-modal-footer">
                        <button id="savePinnedDdays" class="btn btn-primary">選択内容を保存</button>
                    </div>
                </div>
            </div>

            <!-- 일정 위젯용 모달 -->
            <div id="eventModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modalTitle">スケジュール登録</h3>
                        <div id="colorPickerTrigger" class="color-swatch" style="background-color:#2C45BA;"></div>
                    </div>
                    <form id="eventForm" class="eventForm">

                        <div style="display: none;">
                        <div id="colorPalette">
                            <div class="color-swatch selected" data-color="#2C45BA" style="background-color:#2C45BA;"></div>
                            <div class="color-swatch" data-color="#43A5DE" style="background-color:#43A5DE;"></div>
                            <div class="color-swatch" data-color="#0FC79F" style="background-color:#0FC79F;"></div>
                            <div class="color-swatch" data-color="#C084FC" style="background-color:#C084FC;"></div>
                            <div class="color-swatch" data-color="#FE5B00" style="background-color:#FE5B00;"></div>
                            <div class="color-swatch" data-color="#757575" style="background-color:#757575;"></div>
                        </div>
                        </div>

                        <input type="hidden" id="eventColor" name="eventColor" value="#2C45BA">
                        <input type="hidden" id="eventId" name="eventId">

                        <div class="form-group">
                        <label for="eventTitle">題目:</label>
                        <input type="text" id="eventTitle" name="eventTitle">
                        </div>

                        <div class="form-group">
                        <label for="eventContent">内容:</label>
                        <textarea id="eventContent" class="eventContent" name="eventContent"></textarea>
                        </div>

                        <div class="date-inputs-grid">
                        <!-- 시간 포함 입력 (기본 표시) -->
                        <div id="dateTimeInputs" class="form-group">
                            <label for="eventStartDate">開始日時:</label>
                            <input type="datetime-local" id="eventStartDate" name="eventStartDate">
                        </div>

                        <!-- 날짜만 입력 (숨김) -->
                        <div id="dateOnlyInputs" class="form-group" style="display: none;">
                            <label>開始日時:</label>
                            <input type="date" id="startDate" name="startDate">
                        </div>

                        <div id="dateTimeEndInputs" class="form-group">
                            <label for="eventEndDate">終了日時:</label>
                            <input type="datetime-local" id="eventEndDate" name="eventEndDate">
                        </div>

                        <div id="dateOnlyEndInputs" class="form-group" style="display: none;">
                            <label>終了日時:</label>
                            <input type="date" id="endDate" name="endDate">
                        </div>
                        </div>

                        <!-- 종일 일정 체크박스 -->
                        <div class="form-group">
                        <input type="checkbox" id="isAllDay" name="isAllDay">
                        <label for="isAllDay">終日の日程</label>
                        </div>

                        <div id="modalButtons" class="modal-buttons"></div>
                    </form>
                </div>
            </div>
        </div>
        <th:block layout:fragment="script">
            <script th:inline="javascript">
                /*<![CDATA[*/
                    window.currentUser = {
                    userId: /*[[${currentUserId}]]*/ null,
                    username: /*[[${currentUsername}]]*/ null,
                    role: /*[[${currentUserRole}]]*/ null
                };
                /*]]>*/
            </script>
            <!-- FullCalendar CDN -->
            <script src="https://unpkg.com/@popperjs/core@2"></script>
            <script src="https://unpkg.com/tippy.js@6"></script>
            <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
            <script th:src="@{/js/reservation.js}"></script>
            <script th:src="@{/js/scheduleModal.js}"></script>
            <script th:src="@{/js/homeWidget.js}" th:data-dday-url="@{/calendar/dDay}"></script>
        </th:block>
    </body>
</html>
